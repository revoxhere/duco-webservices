<!DOCTYPE html>
<html>
<head>
    <!-- Browser standards -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Duino-Coin | Web Miner</title>
    <!-- SEO Stuff -->
    <meta name="description" content="Duino-Coin Web Miner">
    <meta name="keywords" content="miner, webminer, duinocoin, duco, duco webminer, web miner">
    <link rel="canonical" href="http://51.15.127.80/webminer.html">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#f0932b">
    <!-- Open Graph Metadata -->
    <meta property="og:site_name" content="Duino-Coin Web Miner">
    <meta property="og:site" content="http://51.15.127.80/webminer.html">
    <meta property="og:title" content="Duino-Coin Web Miner">
    <meta property="og:description" content="Duino-Coin Web Miner">
    <meta property="og:image" content="https://github.com/revoxhere/duino-coin/blob/master/Resources/WebMiner.png?raw=true">
    <meta property="og:url" content="http://51.15.127.80/webminer.html">
    <meta property="og:type" content="website">
    <!-- Twitter Metadata -->
    <meta name="twitter:title" content="Duino-Coin Web Miner">
    <meta name="twitter:description" content="Duino-Coin Web Miner">
    <meta name="twitter:image" content="https://github.com/revoxhere/duino-coin/blob/master/Resources/WebMiner.png?raw=true">
    <meta name="twitter:site" content="@CoinDuino">
    <meta name="twitter:creator" content="@CoinDuino">
    <link rel="icon" href="https://github.com/revoxhere/duino-coin/blob/master/Resources/WebMiner.png?raw=true" type="image/png">
    <link rel="shortcut icon" href="https://github.com/revoxhere/duino-coin/blob/master/Resources/WebMiner.png?raw=true" type="image/png">
    <!-- Preload Background Images -->
    <link rel="preload" as="image" href="backgrounds/1-min.png">
    <link rel="preload" as="image" href="backgrounds/2-min.png">
    <link rel="preload" as="image" href="backgrounds/3-min.png">
    <link rel="preload" as="image" href="backgrounds/4-min.png">
    <link rel="preload" as="image" href="backgrounds/5-min.png">
    <link rel="preload" as="image" href="backgrounds/6-min.jpg">
    <link rel="preload" as="image" href="backgrounds/7-min.png">
    <link rel="preload" as="image" href="backgrounds/8-min.png">
    <link rel="preload" as="image" href="backgrounds/9-min.png">
    <!-- Bulma -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-pageloader@0.3.0/dist/css/bulma-pageloader.min.css">
    <!-- Themes -->
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/bulma-prefers-dark" />
    <link rel="stylesheet" id="crisp" disabled="true" type="text/css" href="https://jenil.github.io/bulmaswatch/journal/bulmaswatch.min.css">
    <link rel="stylesheet" id="radiate" disabled="true" type="text/css" href="https://jenil.github.io/bulmaswatch/nuclear/bulmaswatch.min.css">
    <link rel="stylesheet" id="alt" disabled="true" type="text/css" href="https://jenil.github.io/bulmaswatch/materia/bulmaswatch.min.css">
    <link rel="stylesheet" id="material" disabled="true" type="text/css" href="https://jenil.github.io/bulmaswatch/cosmo/bulmaswatch.min.css">
    <!-- Additional CSS-->
    <style>
        .is-primary {
            /* Override Bulmas primary color to Duco-Colored gradient*/
            background: linear-gradient(160deg, #e74c3c, #f39c12) !important;
        }

        body {
            background-size: cover !important;
            background-attachment: fixed !important;
            width: 100% !important;
            height: 500vh !important;
            margin: 0 !important;
            padding: 0 !important;
            background-repeat: no-repeat !important;
        }
    </style>
    <!-- Font Awesome and jQuery-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js" integrity="sha512-RXf+QSDCUQs5uwRKaDoXt55jygZZm2V++WUZduaU/Ui/9EGp3f/2KZVahFZBKGH0s774sd3HmrhUy+SgOFQLVQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.slim.min.js" integrity="sha512-6ORWJX/LrnSjBzwefdNUyLCMTIsGoNP6NftMy2UAm1JBm6PRZCO1d7OHBStWpVFZLO+RerTvqX/Z9mBFfCJZ4A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<script>
    // Random background
    window.addEventListener('load', function ()
    {
        const bg_list = [
            'backgrounds/1-min.png',
            'backgrounds/2-min.png',
            'backgrounds/3-min.png',
            'backgrounds/4-min.png',
            'backgrounds/5-min.png',
            'backgrounds/6-min.jpg',
            'backgrounds/7-min.png',
            'backgrounds/8-min.png',
            'backgrounds/9-min.png'
        ]

        let num = Math.floor(Math.random() * bg_list.length)
        document.body.background = bg_list[num];
    });
</script>
<body>
    <div id="pageloader" class="pageloader is-active is-primary is-bottom-to-top">
        <span class="title">Duino-Coin Web Miner</span>
    </div>
    <div class="container">
        <section class="container">
            <div class="hero-body">
                <div class="box">
                    <p class="title">
                        <img class="icon is-medium" src="https://github.com/revoxhere/duino-coin/blob/master/Resources/WebMiner.png?raw=true">
                        Duino-Coin Web Miner
                    </p>
                    <p class="subtitle">
                        Official JavaScript miner v2.6.5
                        <span class="subtitle is-size-6">
                            by
                            <a href="https://github.com/revoxhere/">revox</a>,
                            <a href="https://github.com/LDarki">LDarki</a>
                            &
                            <a href="https://github.com/sys-256">sys-256</a>
                            <span class="has-text-grey">
                                <br>2020-2021 the Duino-Coin project, distributed under the 
                                <a href="https://opensource.org/licenses/MIT">
                                    MIT license
                                </a>
                                <br>This page is open-source - you can improve it 
                                <a href="https://github.com/revoxhere/playground">
                                    here
                                </a>
                            </span>
                        </span>
                    </p>
                    <p class="subtitle has-text-info is-size-6">
                        <i class="fa fa-info-circle"></i>
                        Make sure you stay on the website during mining - most browsers suspend execution of JavaScript
                        when tab isn't active
                    </p>
                    <form>
                        <div class="columns">
                            <div class="column">
                                <div class="control has-icons-left">
                                    <input class="input has-icons" type="text" id="usernameinput" placeholder="DUCO Username" name="username">
                                    <span class="icon is-left">
                                        <i class="fa fa-user"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="column">
                                <div class="control has-icons-left">
                                    <input class="input has-icons" type="text" id="threadsinput" placeholder="Amount of threads" name="threads">
                                    <span class="icon is-left">
                                        <i class="fa fa-microchip"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="column">
                                <div class="control has-icons-left">
                                    <input class="input has-icons" type="text" id="riginput" placeholder="Rig name (optional)" name="rigid">
                                    <span class="icon is-left">
                                        <i class="fa fa-comment"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="column">
                                <button type="submit" class="button is-link" id="minebuttonclass">
                                    <span id="minebutton">Start mining</span>
                                </button>
                            </div>
                        </div>
                    </form>
                    <div class="columns">
                        <div class="column">
                            <div class="box">
                                <p class="subtitle">
                                    <i class="fa fa-check fa-fw" style="color:#6ab04c;"></i>
                                    ACCEPTED SHARES
                                </p>
                                <p class="title">
                                    <span id="shares">
                                        0/0
                                    </span>
                                    <span class="subtitle" id="sharesperc">
                                        (0%)
                                    </span>
                                </p>
                            </div>
                        </div>
                        <div class="column">
                            <div class="box">
                                <p class="subtitle">
                                    <i class="fa fa-tachometer-alt fa-fw" style="color:#eb4d4b;"></i>
                                    HASHRATE
                                </p>
                                <p class="title">
                                    <span id="hashrate">
                                        0 H/s
                                    </span>
                                </p>
                            </div>
                        </div>
                        <div class="column">
                            <div class="box">
                                <p class="subtitle">
                                    <i class="fa fa-clock fa-fw" style="color:#f0932b;"></i>
                                    ELAPSED TIME
                                </p>
                                <p class="title">
                                    <span data-chronometer>
                                        00:00:00
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="columns">
                        <div class="column">
                            <div class="box">
                                <p class="subtitle">
                                    <i class="fa fa-list fa-fw" style="color:#f39c12;"></i>
                                    MINER LOG
                                </p>
                                <div id="minerlog-scroll-down" style="overflow-y: scroll; word-wrap: break-word; max-height: 12rem;">
                                    <span class="has-text-grey" id="minerlog">Awaiting input...<br><br></span>
                                </div>
                            </div>
                        </div>
                        <div class="column is-two-fifths">
                            <div class="box">
                                <p class="subtitle">
                                    <i class="far fa-chart-bar" style="color:#2980b9;"></i>
                                    STATS PER CPU
                                </p>
                                <div id="stats-per-cpu" style="overflow-y: scroll; word-wrap: break-word; max-height: 12rem;">Awaiting input...</div>
                            </div>
                        </div>
                    </div>
                    <div class="buttons is-centered">
                        <div class="control has-icons-left mb-2 mr-2">
                            <div class="select is-normal">
                                <select id="theme-select">
                                    <option selected value="light">Adaptive (default)</option>
                                    <option value="material">Metro</option>
                                    <option value="crisp">Crisp</option>
                                    <option value="radiance">Nuclear</option>
                                    <option value="altlight">Sleek</option>
                                </select>
                            </div>
                            <span class="icon is-left">
                                <i class="fas fa-sun" style="color:#f0932b"></i>
                            </span>
                        </div>
                        <a href="https://wallet.duinocoin.com" class="button is-secondary">
                            <i class="icon is-small fa fa-wallet" style="color:#f39c12"></i>
                            <span>Web Wallet</span>
                        </a>
                        <a href="https://github.com/revoxhere/duino-coin" class="button is-secondary">
                            <i class="fab fa-fw fa-github icon is-small"></i>&nbsp;
                            <span>GitHub</span>
                        </a>
                        <a href="https://duinocoin.com" class="button is-secondary">
                            <img class="icon is-small" src="https://github.com/revoxhere/duino-coin/blob/master/Resources/duco.png?raw=true">
                            <span>Duino-Coin</span>
                        </a>
                        <a href="https://bulma.io" class="button is-secondary">
                            <span>Made with</span>&nbsp;&nbsp;
                            <img class="image" width="16em" src="https://seeklogo.com/images/B/bulma-logo-45B5145BF4-seeklogo.com.png" alt="Bulma">&nbsp;
                            <span><b>BULMA</b></span>
                        </a>
                    </div>
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                    <ins class="adsbygoogle has-text-centered" style="display:block" data-ad-client="ca-pub-4670059148424169" data-ad-slot="4687652378" data-ad-format="horizontal" data-full-width-responsive="true"></ins>
                    <script>
                        (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>
            </div>
        </section>
    </div>
</body>
</html>
<script>
    let pageloader = document.getElementById("pageloader"); // PAGE LOAGER
    pageloader.setAttribute('class', "pageloader is-active is-primary is-bottom-to-top"); // Before page is loaded
    window.addEventListener('load', function()
    {
        pageloader.setAttribute('class', "pageloader is-primary is-bottom-to-top"); // After page is loaded
    });

    // Theme switcher
    document.getElementById("theme-select").addEventListener('input', updateTheme);

    function updateTheme (event) {
        let theme = event.target.value;
        let radiate = $('#radiate');
        let alt = $('#alt');
        let crisp = $('#crisp');
        let material = $('#material');
        switch (theme) {
            case 'radiance':
                radiate.attr('disabled', false);
                alt.attr('disabled', true);
                crisp.attr('disabled', true);
                material.attr('disabled', true);
                break;
            case 'altlight':
                radiate.attr('disabled', true);
                alt.attr('disabled', false);
                crisp.attr('disabled', true);
                material.attr('disabled', true);
                break;
            case 'light':
                radiate.attr('disabled', true);
                alt.attr('disabled', true);
                crisp.attr('disabled', true);
                material.attr('disabled', true);
                break;
            case 'crisp':
                radiate.attr('disabled', true);
                alt.attr('disabled', true);
                crisp.attr('disabled', false);
                material.attr('disabled', true);
                break;
            case 'material':
            default:
                radiate.attr('disabled', true);
                alt.attr('disabled', true);
                crisp.attr('disabled', true);
                material.attr('disabled', false);
                break;
        }
    }

    //gets the username, rigid and amount of threads from the url parameters
    var url = new URL(window.location);
    var username = url.searchParams.get("username");
    var rigid = url.searchParams.get("rigid");
    let threads = url.searchParams.get("threads");

    if (rigid === "")
    {
        rigid = "None"; //sets the rigid variable to "None", if the user didn't specify one
    }
    
    let userThreads = navigator.hardwareConcurrency; //lets userThreads be the amount of threads the user has
    if (threads === "")
    {
        threads = userThreads; //sets the threads variable to the threads the user has if it didn't gave a number
    }

    if (username != null && username != "" && username != undefined)
    {
        document.getElementById("minebutton").innerHTML = "<i class='fa fa-cogs fa-fw'></i>&nbsp;Mining started";
        document.getElementById("minebuttonclass").style = "background-color: #b8e994;";
        document.getElementById("usernameinput").value = username;
        document.getElementById("riginput").value = rigid;
        document.getElementById("threadsinput").value = threads;
        
        (adsbygoogle = window.adsbygoogle || []).push({});

        //borrowed from waynegraham (https://gist.github.com/waynegraham/5766565), and modified it a bit
        minerlog = function(message)
        {
            $('#minerlog').append(message);
        }

        function getTime()
        {
            let date = new Date();
            let h = date.getHours();
            let m = date.getMinutes();
            let s = date.getSeconds();

            h = (h < 10) ? "0" + h : h;
            m = (m < 10) ? "0" + m : m;
            s = (s < 10) ? "0" + s : s;

            return h + ":" + m + ":" + s;
        }

        let workerVer = 0;
        let sharesCorrect = 0;
        let totalShares = 0;

        let hours = `00`,
            minutes = `00`,
            seconds = `00`;

        let chronometer = setInterval(function()
        {
            seconds++
            if (seconds < 10){seconds = `0` + seconds}
            if (seconds > 59)
            {
                seconds = `00`;
                minutes++;
                if (minutes < 10){minutes = `0` + minutes}
            }
            if (minutes > 59)
            {
                minutes = `00`;
                hours++;
                if (hours < 10){hours = `0` + hours}
            }

            document.querySelector("[data-chronometer]").innerHTML = `${hours}:${minutes}:${seconds}`;
        }, 1000);

        //makes sure the user gives a valid number
        if (threads < 1)
        {
            threads = 1;    
        }

        //makes sure the user doesn't make more then 50 workers
        if (threads > 50)
        {
            threads = 50;
        }

        //makes sure the user doesn't give the miner more threads then it actually has
        if (threads > userThreads)
        {
            minerlog(`${getTime()} | ` + "You gave up more threads then you have. You are now using " + userThreads + " threads instead of " + threads + ".<br><br>");
            console.log(`${getTime()} | ` + "You gave up more threads then you have. You are now using " + userThreads + " threads instead of " + threads + ".");
            threads = userThreads;
        }

        //sets the hashrate to 0
        var hashrates = []
        for (let i = 0; i < threads; i++)
        {
            hashrates[i] = 0;
        }

        //inits the stats per cpu system
        document.getElementById("stats-per-cpu").innerHTML = "";
        for (let i = 0; i < threads; i++)
        {
            $("#stats-per-cpu").append(
                "<p style='font-size: larger'>CPU" + i + ':</p> <span id=CPU'+ i + '-hashrate>Hashrate: 0 kH/s</span><span id=CPU'+ i + '-time> Time: 0s</span><span id=CPU'+ i + '-diff> Difficulty: 0</span><br>'
            );
        }

        //makes threads amount of workers (so if threads is 6, it will make 6 workers)
        for (let workersAmount = 0; workersAmount < threads; workersAmount++)
        {
            var socketWorker = new Worker("js/webminer/worker.js"); //creates the worker
            socketWorker.postMessage('Start,' + username + "," + rigid + ","+ workerVer); //passes the start command, username, rigid and worker version to the worker
            workerVer++; //adds one to workerVer, so you will get CPU0, CPU1, CPU2 etc.

            //executes when the worker sends a message
            socketWorker.onmessage = function(event)
            {
                const data = event.data.split(","); //splits the data so you can use data[1] etc.
                if (data[0] == "UpdateLog")
                {
                    minerlog(data[1]);
                    document.getElementById("minerlog-scroll-down").scrollTop = document.getElementById("minerlog-scroll-down").scrollHeight;

                }
                else if (data[0] == "UpdateHashrate")
                {
                    //total hashrate
                    hashrates[data[3]] = parseFloat(data[2]).toFixed(2);
                    let finalHashrate = 0;
                    for (let i = 0; i < hashrates.length; i++)
                    {
                        finalHashrate = finalHashrate + eval(hashrates[i]);
                    }

                    if (parseFloat(finalHashrate) < 1000)
                    {
                        document.getElementById("hashrate").innerHTML = parseFloat(finalHashrate).toFixed(2) + " H/s";
                    }
                    if (parseFloat(finalHashrate) > 1000)
                    {
                        document.getElementById("hashrate").innerHTML = parseFloat(finalHashrate / 1000).toFixed(2) + " kH/s";
                    }
                    if (parseFloat(finalHashrate) > 1000000)
                    {
                        document.getElementById("hashrate").innerHTML = parseFloat(finalHashrate / 1000000).toFixed(2) + " MH/s";
                    }

                    //personal hashrate
                    if (data[2] < 1000)
                    {
                        document.getElementById("CPU" + data[3] + "-hashrate").innerHTML = "Hashrate: " + parseFloat(data[2]).toFixed(2) + " H/s";
                    }
                    if (data[2] > 1000)
                    {
                        document.getElementById("CPU" + data[3] + "-hashrate").innerHTML = "Hashrate: " + parseFloat(data[2] / 1000).toFixed(2) + " kH/s";
                    }
                    if (data[2] > 1000000)
                    {
                        document.getElementById("CPU" + data[3] + "-hashrate").innerHTML = "Hashrate: " + parseFloat(data[2] / 1000000).toFixed(2) + " MH/s";
                    }

                    //personal timedifference
                    document.getElementById("CPU" + data[3] + "-time").innerHTML = " Time: " + parseFloat(data[1]).toFixed(2) + "s";
                }
                else if (data[0] == "UpdateDiff")
                {
                    document.getElementById("CPU" + data[2] + "-diff").innerHTML = " Difficulty: " + parseFloat(data[1]);
                }
                else if (data[0] == "GoodShare")
                {
                    totalShares++;
                    sharesCorrect++;
                    document.getElementById("shares").innerHTML = sharesCorrect + "/" + totalShares;
                    document.getElementById("sharesperc").innerHTML = " (" + (sharesCorrect / totalShares * 100).toFixed(2) + "%)";
                }
                else if (data[0] == "BadShare")
                {
                    totalShares++;
                    document.getElementById("shares").innerHTML = sharesCorrect + "/" + totalShares;
                    document.getElementById("sharesperc").innerHTML = " (" + (sharesCorrect / totalShares * 100).toFixed(2) + "%)";
                }
                else if (data[0] == "Error")
                {
                    document.getElementById("minebutton").innerHTML = "<i class='fa fa-times fa-fw'></i>&nbsp;Incorrect username";
                    document.getElementById("minebuttonclass").style = "background-color: #c0392b;";
                }
            }
        }
    }
</script>
