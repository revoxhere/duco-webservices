<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Duino-Coin | Web Miner</title>
    <!-- SEO Stuff -->
    <meta name="description" content="Duino-Coin Web Miner">
    <meta name="keywords" content="miner, webminer, duinocoin, duco, duco webminer, web miner">
    <link rel="canonical" href="http://51.15.127.80/webminer.html" />
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#f0932b">
    <!-- Open Graph Metadata -->
    <meta property="og:site_name" content="Duino-Coin Web Miner" />
    <meta property="og:site" content="http://51.15.127.80/webminer.html" />
    <meta property="og:title" content="Duino-Coin Web Miner" />
    <meta property="og:description" content="Duino-Coin Web Miner" />
    <meta property="og:image"
        content="https://github.com/revoxhere/duino-coin/blob/master/Resources/WebMiner.png?raw=true" />
    <meta property="og:url" content="http://51.15.127.80/webminer.html" />
    <meta property="og:type" content="website" />
    <!-- Twitter Metadata -->
    <meta name="twitter:title" content="Duino-Coin Web Miner">
    <meta name="twitter:description" content="Duino-Coin Web Miner">
    <meta name="twitter:image"
        content="https://github.com/revoxhere/duino-coin/blob/master/Resources/WebMiner.png?raw=true">
    <meta name="twitter:site" content="@CoinDuino">
    <meta name="twitter:creator" content="@CoinDuino">
    <link rel="icon" href="https://github.com/revoxhere/duino-coin/blob/master/Resources/WebMiner.png?raw=true"
        type="image/png" />
    <link rel="shortcut icon" href="https://github.com/revoxhere/duino-coin/blob/master/Resources/WebMiner.png?raw=true"
        type="image/png" />
    <!-- Preload Background Images -->
    <link rel="preload" as="image" href="https://i.imgur.com/trNkG47.png">
    <link rel="preload" as="image" href="https://i.imgur.com/MWknhr6.png">
    <link rel="preload" as="image" href="https://i.imgur.com/K1qr6tC.png">
    <link rel="preload" as="image" href="https://i.imgur.com/oYEEfLG.png">
    <!-- Bulma -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-pageloader@0.3.0/dist/css/bulma-pageloader.min.css">
    <style>
        .is-primary {
            /* Override Bulmas primary color to Duco-Colored gradient*/
            background: linear-gradient(160deg, #e74c3c, #f39c12) !important;
        }

        body {
            background-size: cover !important;
            background-attachment: fixed !important;
            width: 100% !important;
            height: 500vh !important;
            margin: 0 !important;
            padding: 0 !important;
            background-repeat: no-repeat !important;
        }
    </style>
    <!-- JS -->
    <script type="text/javascript" src="https://cdn.rawgit.com/h2non/jsHashes/master/hashes.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
        integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
        integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
</head>

<script>
/* GLOBAL JS */
window.addEventListener('load', function () {

    let clickcount = 0;

    // RANDOM BACKGROUND
    let num = Math.ceil(Math.random() * 4);
    if (num <= 1) document.body.background = 'https://i.imgur.com/trNkG47.png';
    if (num == 2) document.body.background = 'https://i.imgur.com/MWknhr6.png';
    if (num == 3) document.body.background = 'https://i.imgur.com/oYEEfLG.png';
    if (num >= 4) document.body.background = 'https://i.imgur.com/K1qr6tC.png';

    document.getElementById('darkmode').onclick = function () {
        clickcount++;
        if (clickcount % 2 == 1) {
            $('head').append('<link rel="stylesheet" type="text/css" href="https://unpkg.com/bulma-prefers-dark">');
        }
        if (clickcount % 2 == 0) {
            $('head').append('<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">');
        }
    }
});
</script>

<body>
    <div id="pageloader" class="pageloader is-active is-primary is-bottom-to-top">
        <span class="title">Duino-Coin Web Miner</span>
    </div>
    <div class="container">
        <section class="container">
            <div class="hero-body">
                <div class="box">
                    <p class="title">
                        <img class="icon is-medium"
                            src="https://github.com/revoxhere/duino-coin/blob/master/Resources/WebMiner.png?raw=true">
                        Duino-Coin Web Miner
                    </p>
                    <p class="subtitle">
                        Official JavaScript miner v2.3.6
                        <span class="subtitle is-size-6">
                            by
                            <a href="https://github.com/revoxhere/">revox</a>
                            &
                            <a href="https://github.com/LDarki">LDarki</a>
                            <br>2020-2021 Duino-Coin Community
                        </span>
                    </p>
                    <p class="subtitle has-text-info is-size-6">
                        <i class="fa fa-info-circle"></i>
                        Make sure you stay on the website during mining - most browsers suspend execution of JavaScript
                        when tab isn't active
                    </p>
                    <p class="subtitle has-text-info is-size-6">
                        <i class="fa fa-info-circle"></i>
                        The use of Web Workers has been implemented.
                    </p>
                    <form>
                        <div class="columns">
                            <div class="column">
                                <div class="control has-icons-left">
                                    <input class="input has-icons" type="text" id="usernameinput"
                                        placeholder="DUCO Username" name="username">
                                    <span class="icon is-left">
                                        <i class="fa fa-user"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="column">
                                <div class="control has-icons-left">
                                    <input class="input has-icons" type="text" id="riginput"
                                        placeholder="Rig name (optional)" name="rigid">
                                    <span class="icon is-left">
                                        <i class="fa fa-comment"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="column">
                                <button type="submit" class="button is-link" id="minebuttonclass">
                                    <span id="minebutton">Start mining</span>
                                </button>
                            </div>
                        </div>
                    </form>
                    <div class="columns">
                        <div class="column">
                            <div class="box">
                                <p class="subtitle">
                                    <i class="fa fa-check fa-fw" style="color:#6ab04c;"></i>
                                    ACCEPTED SHARES
                                </p>
                                <p class="title">
                                    <span id="shares">
                                        0/0
                                    </span>
                                    <span class="subtitle" id="sharesperc">
                                        (0%)
                                    </span>
                                </p>
                            </div>
                        </div>
                        <div class="column">
                            <div class="box">
                                <p class="subtitle">
                                    <i class="fa fa-tachometer-alt fa-fw" style="color:#eb4d4b;"></i>
                                    HASHRATE
                                </p>
                                <p class="title">
                                    <span id="hashrate">
                                        0 H/s
                                    </span>
                                    <span class="subtitle" id="time">
                                        0 s
                                    </span>
                                </p>
                            </div>
                        </div>
                        <div class="column">
                            <div class="box">
                                <p class="subtitle">
                                    <i class="fa fa-cogs fa-fw" style="color:#2980b9;"></i>
                                    DIFFICULTY
                                </p>
                                <p class="title">
                                    <span id="difficulty">
                                        0
                                    </span>
                                    <span class="subtitle" id="difficultytext">
                                    </span>
                                </p>
                            </div>
                        </div>
                        <div class="column">
                            <div class="box">
                                <p class="subtitle">
                                    <i class="fa fa-clock fa-fw" style="color:#2980b9;"></i>
                                    TIME
                                </p>
                                <p class="title">
                                    <span data-chronometer>
                                        00:00:00
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="columns">
                        <div class="column">
                            <div class="box">
                                <p class="subtitle">
                                    <i class="fa fa-list fa-fw" style="color:#f39c12;"></i>
                                    MINER LOG
                                </p>
                                <span style="color:#57606f;" id="minerlog">Awaiting input...</span>
                            </div>
                        </div>
                    </div>
                    <div class="buttons">
                        <button id="darkmode" class="button is-secondary">
                            <i class="fa fa-fw fa-sun is-small icon"></i>&nbsp;
                            <span>Switch theme</span>
                        </button>
                        <a href="http://51.15.127.80/webwallet.html" class="button is-secondary">
                            <i class="icon is-small fa fa-wallet" style="color:#f39c12"></i>
                            <span>Web Wallet</span>
                        </a>
                        <a href="https://github.com/revoxhere/duino-coin" class="button is-secondary">
                            <i class="fab fa-fw fa-github icon is-small"></i>&nbsp;
                            <span>GitHub</span>
                        </a>
                        <a href="https://duinocoin.com" class="button is-secondary">
                            <img class="icon is-small"
                                src="https://github.com/revoxhere/duino-coin/blob/master/Resources/duco.png?raw=true">
                            <span>Duino-Coin</span>
                        </a>
                        <a href="https://bulma.io" class="button is-secondary">
                            <span>Made with</span>&nbsp;&nbsp;
                            <img class="image" width="16em"
                                src="https://seeklogo.com/images/B/bulma-logo-45B5145BF4-seeklogo.com.png"
                                alt="Bulma">&nbsp;
                            <span><b>BULMA</b></span>
                        </a>
                        <a href="https://github.com/h2non/jshashes" class="button is-secondary">
                            <i class="fa fa-fw fa-code icon is-small" style="color:#78e08f;"></i>&nbsp;
                            <span>Hashing with</span>&nbsp;
                            <span><b>jsHashes</b></span>
                        </a>
                    </div>
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                    <ins class="adsbygoogle"
                        style="display:block"
                        data-ad-client="ca-pub-4670059148424169"
                        data-ad-slot="4687652378"
                        data-ad-format="horizontal"
                        data-full-width-responsive="true"></ins>
                    <script>
                        (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>
            </div>
        </section>
    </div>
</body>

</html>
<script type="text/plain" id="socketThread">
    importScripts("https://cdn.rawgit.com/h2non/jsHashes/master/hashes.js");  

    let versionReceived = false;
    let allShares = 0;
    let acceptedShares = 0;
    let inProgress = false;
    let hashrate = 0;
    let diff = "LOW";
    let SHA1 = new Hashes.SHA1();
    let timeDiff;

    function getTime() {
        let date = new Date();
        let h = date.getHours();
        let m = date.getMinutes();
        let s = date.getSeconds();

        h = (h < 10) ? "0" + h : h;
        m = (m < 10) ? "0" + m : m;
        s = (s < 10) ? "0" + s : s;

        return h + ":" + m + ":" + s;
    }

    let minerlog = ["Awaiting input..."];

    self.addEventListener('message', function(event) {
      if (String(event.data).startsWith("Start")) { // Create websocket connection

        let getData = String(event.data).split(",")

        let username = getData[1];
        let rigid = getData[2];
    
        if (rigid === "") {
            rigid = "None"
        }

        let socket;

        console.info("Trying to use WSS");

        try {
            socket = new WebSocket("wss://server.duinocoin.com:15808", null, 5000, 5);
            /* If is http this sends error */
        } catch(e)
        {
            console.info("WSS error, using insecure websocket");
            socket = new WebSocket("ws://51.15.127.80:14808", null, 5000, 5);
        }

        socket.onmessage = async function (msg) {
            serverMessage = msg.data.replace("\n", "");
            if (serverMessage.includes("2.")) {
                self.postMessage("[WebWorker] Version received: " + serverMessage);
                versionReceived = true;
                setTimeout(() => { socket.send("JOB," + username + "," + diff) }, 500);
            }

            if (versionReceived && serverMessage === "GOOD" || serverMessage === "BLOCK") {
                console.log(`[${getTime()}]` + "Share accepted:" + result);
                minerlog.push(`[${getTime()}]` + "Share accepted: " + result);
                acceptedShares++;
                allShares++;
                postMessage("Update,"+allShares+","+acceptedShares)
                setTimeout(() => { socket.send("JOB," + username + "," + diff) }, 500);
            }

            if (versionReceived && serverMessage === "BAD") {
                console.log("Share rejected");
                minerlog.push("Share rejected: " + result);
                allShares++;
                postMessage("Update,"+allShares+","+acceptedShares)
                setTimeout(() => { socket.send("JOB," + username + "," + diff) }, 500);
            }

            if (versionReceived && serverMessage.includes("This user doesn't exist")) {
                console.log("User not found!");
                postMessage("Error");
            }
            if (versionReceived && serverMessage.length > 40) {
                console.log(`[${getTime()}]` + "Job received: " + serverMessage);
                minerlog.push(`[${getTime()}]` + "Job received: " + serverMessage);
                job = serverMessage.split(",");
                difficulty = job[2];

                if (difficulty > 15000) {
                    postMessage("UpdateDiff2,MEDIUM");
                } else {
                    postMessage("UpdateDiff2,LOW")
                }

                postMessage("UpdateDiff,"+difficulty);

                startTime = new Date();
                for (result = 0; result < 100 * difficulty + 1; result++) {
                    ducos1 = SHA1.hex(job[0] + result)
                    if (job[1] === ducos1) {
                        endTime = new Date();
                        timeDiff = (endTime - startTime) / 1000;
                        hashrate = (result / timeDiff).toFixed(2);

                        console.log(`[${getTime()}]` + "Share found: " + result + " Time: " + timeDiff + " Hashrate: " + hashrate);
                        minerlog.push(`[${getTime()}]` + "Share found: " + result + " Time: " + timeDiff + " Hashrate: " + hashrate);
                        postMessage("UpdateHashrate,"+timeDiff+","+hashrate)

                        socket.send(result + "," + hashrate + ",Official Webminer v2.3.6," + rigid); // send the result to the server
                        break;
                    }
                }
            }
        }
      }
    });
    let finalstring = "";

    let intervalId = setInterval(function () {
        finalstring = "";
        for (miner in minerlog) {
            if (minerlog[miner - 2] != undefined) {
                finalstring = minerlog[miner - 2] + "<br>";
            }
            if (minerlog[miner - 1] != undefined) {
                finalstring += minerlog[miner - 1] + "<br>";
            }
            if (minerlog[miner] != undefined) {
                finalstring += minerlog[miner];
            }
        }
        postMessage("UpdateLog,"+finalstring);
    }, 1000);
</script>

<script>
    let pageloader = document.getElementById("pageloader"); // PAGE LOAGER
    pageloader.setAttribute('class', "pageloader is-active is-primary is-bottom-to-top"); // Before page is loaded
    window.addEventListener('load', function () {
        pageloader.setAttribute('class', "pageloader is-primary is-bottom-to-top"); // After page is loaded
    });

    if (typeof (Worker) !== "undefined") {
        console.info("[Info]: WebWorkers supported.");

        window.addEventListener('load', function () {
            let url_string = window.location;
            let url = new URL(url_string);
            let username = url.searchParams.get("username");
            let rigid = url.searchParams.get("rigid");

            if (rigid === "") {
                rigid = "None"
            }

            if (username != null && username != "" && username != undefined) {
                document.getElementById("minebutton").innerHTML = "<i class='fa fa-cogs fa-fw'></i>&nbsp;Mining started";
                document.getElementById("minebuttonclass").style = "background-color: #b8e994;";
                document.getElementById("usernameinput").value = username;
                document.getElementById("riginput").value = rigid;

                let socketT = document.getElementById('socketThread').innerText;
                let blob = new Blob([socketT]);
                let blobURL = window.URL.createObjectURL(blob);
                const socketWorker = new Worker(blobURL);

                socketWorker.postMessage('Start,' + username + "," + rigid); // Send the Start action to the worker.

                let hours = `00`,
                    minutes = `00`,
                    seconds = `00`;

                let chronometer = setInterval(function () {
                    seconds++
                    if (seconds < 10) seconds = `0` + seconds
                    if (seconds > 59) {
                        seconds = `00`
                        minutes++
                        if (minutes < 10) minutes = `0` + minutes
                    }
                    if (minutes > 59) {
                        minutes = `00`
                        hours++
                        if (hours < 10) hours = `0` + hours
                    }

                    document.querySelector("[data-chronometer]").innerHTML = `${hours}:${minutes}:${seconds}`;
                }, 1000);

                socketWorker.addEventListener('message', function (evt) {
                    let msg = String(evt.data);
                    const data = msg.split(",");
                    if (data[0] == "UpdateLog") {
                        document.getElementById("minerlog").innerHTML = msg.replace("UpdateLog", "");
                    }
                    else if (data[0] == "UpdateDiff") {
                        document.getElementById("difficulty").innerHTML = data[1];
                    }
                    else if (data[0] == "UpdateDiff2") {
                        document.getElementById("difficultytext").innerHTML = data[1];
                    }
                    else if (data[0] == "UpdateHashrate") {
                        document.getElementById("time").innerHTML = parseInt(data[1]).toFixed(2) + " s";
                        document.getElementById("hashrate").innerHTML = parseFloat(data[2] / 1000).toFixed(0) + " kH/s";
                    }
                    else if (data[0] == "Update") {
                        let acceptedShares = parseFloat(data[2]),
                            allShares = parseFloat(data[1]);
                        document.getElementById("shares").innerHTML = acceptedShares + "/" + allShares;
                        document.getElementById("sharesperc").innerHTML = " (" + (acceptedShares / allShares * 100).toFixed(2) + "%)";
                    }
                    else if (data[0] == "Error") {
                        document.getElementById("minebutton").innerHTML = "<i class='fa fa-times fa-fw'></i>&nbsp;Incorrect username";
                        document.getElementById("minebuttonclass").style = "background-color: #c0392b;";
                    }
                });
            }
        });
    } else {
        console.info("[Info]: WebWorkers not supported.");

        window.addEventListener('load', function () {
            let hours = `00`,
                minutes = `00`,
                seconds = `00`;

            function getTime() {
                let date = new Date();
                let h = date.getHours();
                let m = date.getMinutes();
                let s = date.getSeconds();

                if (h == 0) {
                    h = 12;
                }

                h = (h < 10) ? "0" + h : h;
                m = (m < 10) ? "0" + m : m;
                s = (s < 10) ? "0" + s : s;

                return h + ":" + m + ":" + s;
            }

            function chronometer() {
                seconds++
                if (seconds < 10) seconds = `0` + seconds
                if (seconds > 59) {
                    seconds = `00`
                    minutes++
                    if (minutes < 10) minutes = `0` + minutes
                }
                if (minutes > 59) {
                    minutes = `00`
                    hours++
                    if (hours < 10) hours = `0` + hours
                }
                document.querySelector("[data-chronometer]").innerHTML = `${hours}:${minutes}:${seconds}`
            }

            let versionReceived = false;
            let allShares = 0;
            let acceptedShares = 0;
            let inProgress = false;
            let hashrate = 0;
            let diff = "LOW";
            let SHA1 = new Hashes.SHA1();
            let timeDiff;

            let url_string = window.location;
            let url = new URL(url_string);
            let username = url.searchParams.get("username");
            let rigid = url.searchParams.get("rigid");

            if (rigid === "") {
                rigid = "None"
            }

            if (username != null && username != "" && username != undefined) {

                let minerlog = ["Awaiting input..."];
                let finalstring = "";
                let intervalId = window.setInterval(function () {
                    for (miner in minerlog) {
                        finalstring = "";
                        if (minerlog[miner - 2] != undefined) {
                            finalstring = minerlog[miner - 2] + "<br>";
                        }
                        if (minerlog[miner - 1] != undefined) {
                            finalstring += minerlog[miner - 1] + "<br>";
                        }
                        if (minerlog[miner] != undefined) {
                            finalstring += minerlog[miner];
                        }
                    }
                    document.getElementById("minerlog").innerHTML = finalstring;
                }, 100);


                document.getElementById("minebutton").innerHTML = "<i class='fa fa-cogs fa-fw'></i>&nbsp;Mining started";
                document.getElementById("minebuttonclass").style = "background-color: #b8e994;";

                setInterval(chronometer, 1000)
                document.getElementById("usernameinput").value = username;
                document.getElementById("riginput").value = rigid;

                let socket;

                console.info("Trying to use WSS");

                try {
                    socket = new WebSocket("wss://server.duinocoin.com:15808", null, 5000, 5);
                    /* If is http this sends error */
                } catch(e)
                {
                    console.info("WSS error, using insecure websocket");
                    socket = new WebSocket("ws://51.15.127.80:14808", null, 5000, 5);
                }

                socket.onmessage = async function (msg) {
                    serverMessage = msg.data.replace("\n", "");
                    if (serverMessage.includes("2.")) {
                        console.log("Version received: " + serverMessage);
                        minerlog.push("Version received: " + serverMessage);
                        versionReceived = true;
                        setTimeout(() => { socket.send("JOB," + username + "," + diff) }, 500);
                    }

                    if (versionReceived && serverMessage === "GOOD" || serverMessage === "BLOCK") {
                        console.log(`[${getTime()}]` + "Share accepted:" + result);
                        minerlog.push(`[${getTime()}]` + "Share accepted: " + result);
                        acceptedShares++;
                        allShares++;
                        document.getElementById("shares").innerHTML = acceptedShares + "/" + allShares;
                        document.getElementById("sharesperc").innerHTML = " (" + (acceptedShares / allShares * 100).toFixed(2) + "%)";
                        document.getElementById("hashrate").innerHTML = (hashrate / 1000).toFixed(0) + " kH/s";
                        document.getElementById("time").innerHTML = (timeDiff).toFixed(2) + " s";
                        setTimeout(() => { socket.send("JOB," + username + "," + diff) }, 500);
                    }

                    if (versionReceived && serverMessage === "BAD") {
                        console.log("Share rejected");
                        minerlog.push("Share rejected: " + result);
                        allShares++;
                        document.getElementById("shares").innerHTML = acceptedShares + "/" + allShares;
                        document.getElementById("sharesperc").innerHTML = " (" + (acceptedShares / allShares * 100).toFixed(2) + "%)";
                        document.getElementById("hashrate").innerHTML = (hashrate / 1000).toFixed(0) + " kH/s";
                        document.getElementById("time").innerHTML = (timeDiff).toFixed(2) + " s";
                        setTimeout(() => { socket.send("JOB," + username + "," + diff) }, 500);
                    }

                    if (versionReceived && serverMessage.includes("This user doesn't exist")) {
                        console.log("User not found!");
                        document.getElementById("minebutton").innerHTML = "<i class='fa fa-times fa-fw'></i>&nbsp;Incorrect username";
                        document.getElementById("minebuttonclass").style = "background-color: #c0392b;";
                    }

                    if (versionReceived && serverMessage.length > 40) {
                        console.log(`[${getTime()}]` + "Job received: " + serverMessage);
                        minerlog.push(`[${getTime()}]` + "Job received: " + serverMessage);
                        job = serverMessage.split(",");
                        difficulty = job[2];

                        if (difficulty > 15000) {
                            document.getElementById("difficultytext").innerHTML = "MEDIUM";
                        } else {
                            document.getElementById("difficultytext").innerHTML = "LOW";
                        }

                        document.getElementById("difficulty").innerHTML = difficulty;

                        startTime = new Date();
                        for (result = 0; result < 100 * difficulty + 1; result++) {
                            ducos1 = SHA1.hex(job[0] + result)
                            if (job[1] === ducos1) {
                                endTime = new Date();
                                timeDiff = (endTime - startTime) / 1000;
                                hashrate = (result / timeDiff).toFixed(2);

                                console.log(`[${getTime()}]` + "Share found: " + result + " Time: " + timeDiff + " Hashrate: " + hashrate);
                                minerlog.push(`[${getTime()}]` + "Share found: " + result + " Time: " + timeDiff + " Hashrate: " + hashrate);

                                socket.send(result + "," + hashrate + ",Official Webminer v2.3.6," + rigid); // send the result to the server
                                break;
                            }
                        }
                    }
                }
            }
        });
    }
</script>
